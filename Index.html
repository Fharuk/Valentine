<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine OS v3.4</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        const TUNES = {
            jazz: "https://cdn.pixabay.com/download/audio/2022/02/10/audio_fc8c81216a.mp3?filename=smooth-jazz-112932.mp3",
            lofi: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3",
            pop: "https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=pop-1-1095.mp3"
        };
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'romance': '#FF7EB3',
                        'passion': '#FF758C',
                        'glass': 'rgba(255, 255, 255, 0.25)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pop': 'pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        heartbeat: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.05)' } },
                        slideUp: { '0%': { transform: 'translateY(40px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        pop: { '0%': { transform: 'scale(0.9) opacity(0)' }, '100%': { transform: 'scale(1) opacity(1)' } }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap');

        body {
            overflow: hidden;
            background: linear-gradient(135deg, #FF758C 0%, #FF7EB3 50%, #FF758C 100%);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
            touch-action: manipulation;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            backdrop-filter: blur(4px);
            transition: all 0.2s;
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.25);
            outline: none;
            border-color: #fff;
        }
        .glass-input option {
            background-color: #FF758C; /* Fallback for mobile */
            color: black;
        }
        ::placeholder { color: rgba(255, 255, 255, 0.6); }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- INLINE ICONS ---
        const IconHeart = ({className}) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>);
        const IconMusic = ({className}) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>);
        const IconLock = ({className}) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>);
        const IconCopy = ({className}) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>);
        const IconCalendar = ({className}) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>);

        // --- UTILS ---
        const playAudio = (type) => {
            const audio = new Audio(TUNES[type] || TUNES.lofi);
            audio.loop = true;
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Audio require interaction"));
            return audio;
        };

        const generateICS = (event) => {
            const text = [
                'BEGIN:VCALENDAR', 'VERSION:2.0', 'BEGIN:VEVENT',
                `SUMMARY:Valentine's Date with ${event.who}`,
                `DTSTART:${event.date.replace(/-/g, '')}T${event.time.replace(/:/g, '')}00`,
                `DTEND:${event.date.replace(/-/g, '')}T${parseInt(event.time.slice(0,2))+2}${event.time.slice(2)}00`,
                `DESCRIPTION:Activity: ${event.activity} | Food: ${event.food}`,
                `LOCATION:${event.activity}`,
                'END:VEVENT', 'END:VCALENDAR'
            ].join('\n');
            const blob = new Blob([text], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'valentines_date.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- COMPONENTS ---

        // 1. CREATOR DASHBOARD
        const CreatorMode = () => {
            const [formData, setFormData] = useState({
                to: '', from: '', message: 'Will you be my Valentine?', vibe: 'lofi'
            });
            const [link, setLink] = useState('');

            const generate = () => {
                if(!formData.to || !formData.from) return alert("Names are required!");
                const params = new URLSearchParams(formData).toString();
                const finalLink = `${window.location.origin}${window.location.pathname}?${params}`;
                setLink(finalLink);
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-panel w-full max-w-lg p-8 rounded-3xl animate-slide-up relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-300 to-rose-400"></div>
                        
                        <div className="flex items-center gap-3 mb-6">
                            <div className="bg-white/20 p-3 rounded-full"><IconHeart className="text-white fill-white" /></div>
                            <div>
                                <h1 className="text-2xl font-bold text-white">Valentine OS <span className="text-xs opacity-70 border border-white/30 px-2 py-0.5 rounded-full">v3.4</span></h1>
                                <p className="text-white/70 text-sm">Create your conversion trap.</p>
                            </div>
                        </div>

                        <div className="space-y-4">
                            <h3 className="text-white font-semibold flex items-center gap-2"><IconLock className="w-4 h-4"/> Core Details</h3>
                            <input placeholder="Their Name (Target)" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setFormData({...formData, to: e.target.value})} />
                            <input placeholder="Your Name (Sender)" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setFormData({...formData, from: e.target.value})} />
                            <input placeholder="The Question" defaultValue="Will you be my Valentine?" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setFormData({...formData, message: e.target.value})} />
                            
                            <h3 className="text-white font-semibold flex items-center gap-2 mt-4"><IconMusic className="w-4 h-4"/> Vibe Control</h3>
                            <select className="w-full glass-input rounded-xl px-4 py-3 text-white bg-white/20" onChange={e => setFormData({...formData, vibe: e.target.value})}>
                                <option value="lofi" className="text-black">Lo-Fi Chill</option>
                                <option value="jazz" className="text-black">Smooth Jazz</option>
                                <option value="pop" className="text-black">Upbeat Pop</option>
                            </select>
                        </div>

                        <div className="mt-8 pt-6 border-t border-white/20">
                            {!link ? (
                                <button onClick={generate} className="w-full bg-white text-rose-500 font-bold py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.01] transition-all flex items-center justify-center gap-2">
                                    <IconHeart className="fill-current w-5 h-5"/> Generate Link
                                </button>
                            ) : (
                                <div className="bg-black/20 p-4 rounded-xl backdrop-blur-sm border border-white/30">
                                    <p className="text-white/80 text-xs font-mono break-all mb-3 bg-black/20 p-2 rounded">{link}</p>
                                    <div className="flex gap-3">
                                        <button onClick={() => navigator.clipboard.writeText(link)} className="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                                            <IconCopy className="w-5 h-5"/> Copy Link
                                        </button>
                                        <a href={link} target="_blank" className="flex-1 bg-white/20 hover:bg-white/30 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                                            Test It
                                        </a>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 2. THE TRAP (TARGET MODE)
        const TargetMode = ({ params }) => {
            // --- STATE (Must be top level) ---
            const [step, setStep] = useState(0); 
            const [tilt, setTilt] = useState({ x: 0, y: 0 });
            const [noBtn, setNoBtn] = useState({ x: 0, y: 0, hover: 0 });
            const [yesScale, setYesScale] = useState(1);
            const [plan, setPlan] = useState({ date: '', time: '', food: 'Suya & Asun', activity: 'Arcade & Gaming' });
            
            const to = params.get('to');
            const from = params.get('from');
            const msg = params.get('message');
            const vibe = params.get('vibe');

            useEffect(() => {
                const handleMove = (e) => {
                    const x = (window.innerWidth / 2 - e.clientX) / 25;
                    const y = (window.innerHeight / 2 - e.clientY) / 25;
                    setTilt({ x, y });
                };
                window.addEventListener('mousemove', handleMove);
                return () => window.removeEventListener('mousemove', handleMove);
            }, []);

            // Step 0: Gatekeeper
            if (step === 0) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm z-50">
                        <div className="text-center animate-slide-up">
                            <div className="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-md animate-heartbeat">
                                <IconHeart className="text-white fill-white w-10 h-10" />
                            </div>
                            <h1 className="text-white text-3xl font-serif font-bold mb-2">For {to}</h1>
                            <p className="text-white/70 mb-8">A special message from {from}</p>
                            <button onClick={() => { playAudio(vibe); setStep(1); }} className="bg-white text-rose-500 px-10 py-4 rounded-full font-bold text-lg shadow-xl hover:scale-105 transition-transform">
                                Open Message
                            </button>
                        </div>
                    </div>
                );
            }

            // Step 1: The Main Trap
            if (step === 1) {
                const moveNo = () => {
                    setNoBtn({ 
                        x: Math.random() * 200 - 100, 
                        y: Math.random() * 200 - 100,
                        hover: noBtn.hover + 1
                    });
                    setYesScale(s => Math.min(s + 0.1, 1.5));
                };

                const handleYes = () => {
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    setStep(2);
                };

                const rejections = ["No", "Are you sure?", "Really?", "Don't do this", "Last chance!", "Heartbreaker!"];

                return (
                    <div className="min-h-screen flex items-center justify-center p-4" 
                         style={{ transform: `perspective(1000px) rotateX(${tilt.y}deg) rotateY(${tilt.x}deg)` }}>
                        <div className="glass-panel p-8 sm:p-12 rounded-[40px] flex flex-col items-center max-w-md w-full relative transition-transform duration-100 ease-out">
                            <div className="mb-8 relative w-40 h-40 animate-float">
                                <svg viewBox="0 0 24 24" className="w-full h-full drop-shadow-[0_10px_20px_rgba(255,100,100,0.5)]">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="#ff4d6d" stroke="white" strokeWidth="1"/>
                                </svg>
                            </div>
                            
                            <h1 className="font-serif text-3xl sm:text-4xl text-slate-800 font-bold text-center mb-10 leading-tight">
                                {msg}
                            </h1>

                            <div className="flex flex-col items-center gap-4 w-full relative h-32">
                                <button onClick={handleYes} style={{ transform: `scale(${yesScale})` }} className="z-20 bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold text-xl py-4 px-12 rounded-full shadow-xl hover:shadow-2xl hover:scale-105 transition-all w-full max-w-[240px]">
                                    Yes, I will! ðŸ’–
                                </button>
                                
                                <button onMouseEnter={moveNo} onTouchStart={(e) => {e.preventDefault(); moveNo()}} 
                                    style={{ transform: `translate(${noBtn.x}px, ${noBtn.y}px)` }}
                                    className="glass-button text-slate-600 font-medium py-2 px-6 rounded-full absolute bottom-0 border border-white/40 hover:bg-white/30 transition-all duration-300">
                                    {rejections[Math.min(noBtn.hover, 5)]}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Step 2: Scheduler
            const finish = () => {
                const text = `Hey ${from}! I said YES! ðŸ’–\n\nI'm free on ${plan.date} at ${plan.time}.\nWe're getting ${plan.food} for ${plan.activity}.\n\nAdd to calendar: (See attachment)`;
                generateICS({ ...plan, who: from });
                window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-panel p-8 rounded-[32px] w-full max-w-md animate-pop">
                        <div className="text-center mb-8">
                            <h1 className="font-serif text-3xl text-white font-bold mb-2">It's a Date! ðŸŽ‰</h1>
                            <p className="text-white/80">Lock it in so I don't forget.</p>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="text-xs text-white/70 ml-2 mb-1 block">When?</label>
                                <input type="date" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, date: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-xs text-white/70 ml-2 mb-1 block">Time?</label>
                                <input type="time" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, time: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="text-xs text-white/70 ml-2 mb-1 block">Chow?</label>
                                    <select className="w-full glass-input rounded-xl px-4 py-3 text-white bg-white/20" onChange={e => setPlan({...plan, food: e.target.value})}>
                                        <option className="text-black">Suya & Asun</option>
                                        <option className="text-black">Zobo</option>
                                        <option className="text-black">Chapman</option>
                                        <option className="text-black">Mama put</option>
                                        <option className="text-black">Bread & beans</option>
                                        <option className="text-black">Snacks</option>
                                        <option className="text-black">Shawarma</option>
                                        <option className="text-black">Bread & Akara</option>
                                        <option className="text-black">Coconut Candy</option>
                                        <option className="text-black">Boli & Groundnut</option>
                                        <option className="text-black">Surprise me</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs text-white/70 ml-2 mb-1 block">Vibe?</label>
                                    <select className="w-full glass-input rounded-xl px-4 py-3 text-white bg-white/20" onChange={e => setPlan({...plan, activity: e.target.value})}>
                                        <option className="text-black">Arcade & Gaming</option>
                                        <option className="text-black">Walk in the Park</option>
                                        <option className="text-black">Library date</option>
                                        <option className="text-black">Karaoke Night</option>
                                        <option className="text-black">Genital greetings with each other</option>
                                        <option className="text-black">Nature & Scenic Escapes</option>
                                        <option className="text-black">Beach Day Getaway</option>
                                        <option className="text-black">Horseback Riding</option>
                                        <option className="text-black">Surprise me</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <button onClick={finish} className="w-full bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-600 transition-all mt-8 flex items-center justify-center gap-2">
                            <IconCalendar className="w-5 h-5"/> Confirm & Send
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [params, setParams] = useState(null);
            useEffect(() => {
                const p = new URLSearchParams(window.location.search);
                if (p.has('to')) setParams(p);
            }, []);
            return params ? <TargetMode params={params} /> : <CreatorMode />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
