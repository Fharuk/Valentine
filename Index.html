<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine OS v3.0</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        const TUNES = {
            jazz: "https://cdn.pixabay.com/download/audio/2022/02/10/audio_fc8c81216a.mp3?filename=smooth-jazz-112932.mp3",
            lofi: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3",
            pop: "https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=pop-1-1095.mp3"
        };
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'romance': '#FF7EB3',
                        'passion': '#FF758C',
                        'glass': 'rgba(255, 255, 255, 0.25)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1)',
                        'fade-in': 'fadeIn 1s ease-out',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        heartbeat: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.05)' } },
                        slideUp: { '0%': { transform: 'translateY(40px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap');

        body {
            overflow: hidden;
            background: linear-gradient(135deg, #FF758C 0%, #FF7EB3 50%, #FF758C 100%);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
            touch-action: manipulation;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            backdrop-filter: blur(4px);
            transition: all 0.2s;
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.25);
            outline: none;
            border-color: #fff;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Heart, Music, Calendar, Share2, Copy, Lock, Smartphone, ChevronRight, CheckCircle } = lucide;

        // --- UTILS ---
        const playAudio = (type) => {
            const audio = new Audio(TUNES[type] || TUNES.lofi);
            audio.loop = true;
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Audio require interaction"));
            return audio;
        };

        const generateICS = (event) => {
            const text = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'BEGIN:VEVENT',
                `SUMMARY:Valentine's Date with ${event.who}`,
                `DTSTART:${event.date.replace(/-/g, '')}T${event.time.replace(/:/g, '')}00`,
                `DTEND:${event.date.replace(/-/g, '')}T${parseInt(event.time.slice(0,2))+2}${event.time.slice(2)}00`,
                `DESCRIPTION:Activity: ${event.activity} | Food: ${event.food}`,
                `LOCATION:${event.activity}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\n');
            const blob = new Blob([text], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'valentines_date.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- COMPONENTS ---

        // 1. CREATOR DASHBOARD
        const CreatorMode = () => {
            const [formData, setFormData] = useState({
                to: '', from: '', message: 'Will you be my Valentine?',
                img1: '', img2: '', img3: '',
                vibe: 'lofi',
                webhook: ''
            });
            const [link, setLink] = useState('');

            const generate = () => {
                if(!formData.to || !formData.from) return alert("Names are required!");
                const params = new URLSearchParams(formData).toString();
                const finalLink = `${window.location.origin}${window.location.pathname}?${params}`;
                setLink(finalLink);
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-panel w-full max-w-2xl p-8 rounded-3xl animate-slide-up relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-300 to-rose-400"></div>
                        
                        <div className="flex items-center gap-3 mb-6">
                            <div className="bg-white/20 p-3 rounded-full"><Heart className="text-white fill-white" /></div>
                            <div>
                                <h1 className="text-2xl font-bold text-white">Valentine OS <span className="text-xs opacity-70 border border-white/30 px-2 py-0.5 rounded-full">v3.0</span></h1>
                                <p className="text-white/70 text-sm">Configure your conversion trap.</p>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <h3 className="text-white font-semibold flex items-center gap-2"><Lock size={16}/> Core Data</h3>
                                <input placeholder="Their Name (Target)" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, to: e.target.value})} />
                                <input placeholder="Your Name (Sender)" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, from: e.target.value})} />
                                <input placeholder="The Question" defaultValue="Will you be my Valentine?" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, message: e.target.value})} />
                                
                                <h3 className="text-white font-semibold flex items-center gap-2 mt-6"><Music size={16}/> Vibe Control</h3>
                                <select className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setFormData({...formData, vibe: e.target.value})}>
                                    <option value="lofi" className="text-black">Lo-Fi Chill (Safe)</option>
                                    <option value="jazz" className="text-black">Smooth Jazz (Classy)</option>
                                    <option value="pop" className="text-black">Upbeat Pop (Fun)</option>
                                </select>
                            </div>

                            <div className="space-y-4">
                                <h3 className="text-white font-semibold flex items-center gap-2"><Smartphone size={16}/> Memory Lane (Optional)</h3>
                                <p className="text-xs text-white/60">Paste direct image URLs (Discord/Imgur/etc.)</p>
                                <input placeholder="Photo URL 1 (The Meet)" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, img1: e.target.value})} />
                                <input placeholder="Photo URL 2 (The Memory)" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, img2: e.target.value})} />
                                <input placeholder="Photo URL 3 (The Closer)" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, img3: e.target.value})} />
                                
                                <h3 className="text-white font-semibold flex items-center gap-2 mt-6"><Share2 size={16}/> Surveillance (Optional)</h3>
                                <input placeholder="Discord Webhook URL" className="w-full glass-input rounded-xl px-4 py-3 placeholder-white/50" onChange={e => setFormData({...formData, webhook: e.target.value})} />
                                <p className="text-[10px] text-white/50">Only for advanced users. Triggers when they open the link.</p>
                            </div>
                        </div>

                        <div className="mt-8 pt-6 border-t border-white/20">
                            {!link ? (
                                <button onClick={generate} className="w-full bg-white text-rose-500 font-bold py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.01] transition-all flex items-center justify-center gap-2">
                                    <Heart className="fill-current" size={20}/> Generate Trap Link
                                </button>
                            ) : (
                                <div className="bg-black/20 p-4 rounded-xl backdrop-blur-sm border border-white/30">
                                    <p className="text-white/80 text-xs font-mono break-all mb-3 bg-black/20 p-2 rounded">{link}</p>
                                    <div className="flex gap-3">
                                        <button onClick={() => navigator.clipboard.writeText(link)} className="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                                            <Copy size={18}/> Copy Link
                                        </button>
                                        <a href={link} target="_blank" className="flex-1 bg-white/20 hover:bg-white/30 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                                            Test It <ChevronRight size={18}/>
                                        </a>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 2. THE TRAP (TARGET MODE)
        const TargetMode = ({ params }) => {
            const [step, setStep] = useState(0); // 0:Gate, 1:Memory, 2:Main, 3:Success, 4:Schedule
            const [audio, setAudio] = useState(null);
            const [tilt, setTilt] = useState({ x: 0, y: 0 });
            
            // Trap Data
            const to = params.get('to');
            const from = params.get('from');
            const msg = params.get('message');
            const vibe = params.get('vibe');
            const webhook = params.get('webhook');
            const images = [params.get('img1'), params.get('img2'), params.get('img3')].filter(Boolean);

            // "No" Button Physics
            const [noBtn, setNoBtn] = useState({ x: 0, y: 0, hover: 0 });
            const [yesScale, setYesScale] = useState(1);

            // Webhook Trigger (The Snitch)
            useEffect(() => {
                if (webhook && step === 0) {
                    try {
                        navigator.sendBeacon(webhook, JSON.stringify({ content: `ðŸš¨ **ALERT**: ${to} has opened the Valentine Trap!` }));
                    } catch(e) {}
                }
            }, []);

            // Parallax Effect
            useEffect(() => {
                const handleMove = (e) => {
                    const x = (window.innerWidth / 2 - e.clientX) / 25;
                    const y = (window.innerHeight / 2 - e.clientY) / 25;
                    setTilt({ x, y });
                };
                window.addEventListener('mousemove', handleMove);
                return () => window.removeEventListener('mousemove', handleMove);
            }, []);

            // Step 0: Gatekeeper (Unlock Audio)
            if (step === 0) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm z-50">
                        <div className="text-center animate-slide-up">
                            <div className="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-md animate-heartbeat">
                                <Heart size={40} className="text-white fill-white" />
                            </div>
                            <h1 className="text-white text-3xl font-serif font-bold mb-2">For {to}</h1>
                            <p className="text-white/70 mb-8">A special message from {from}</p>
                            <button onClick={() => {
                                setAudio(playAudio(vibe));
                                setStep(images.length > 0 ? 1 : 2);
                            }} className="bg-white text-rose-500 px-10 py-4 rounded-full font-bold text-lg shadow-xl hover:scale-105 transition-transform">
                                Open Message
                            </button>
                        </div>
                    </div>
                );
            }

            // Step 1: Memory Lane (Carousel)
            if (step === 1) {
                const [slide, setSlide] = useState(0);
                useEffect(() => {
                    if (slide >= images.length) {
                        setTimeout(() => setStep(2), 2000);
                        return;
                    }
                    const timer = setTimeout(() => setSlide(s => s + 1), 3500); // 3.5s per slide
                    return () => clearTimeout(timer);
                }, [slide]);

                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        {slide < images.length ? (
                            <div className="glass-panel p-4 rounded-3xl max-w-sm w-full aspect-[4/5] relative overflow-hidden animate-fade-in">
                                <img src={images[slide]} className="w-full h-full object-cover rounded-2xl" />
                                <div className="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-black/80 to-transparent">
                                    <p className="text-white font-serif text-xl italic">Remember this?</p>
                                </div>
                            </div>
                        ) : (
                            <div className="text-white font-serif text-3xl animate-pulse">Ready?</div>
                        )}
                    </div>
                );
            }

            // Step 2: The Main Trap
            if (step === 2) {
                const moveNo = () => {
                    setNoBtn({ 
                        x: Math.random() * 200 - 100, 
                        y: Math.random() * 200 - 100,
                        hover: noBtn.hover + 1
                    });
                    setYesScale(s => Math.min(s + 0.1, 1.5));
                };

                const handleYes = () => {
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    setStep(3);
                    if (webhook) navigator.sendBeacon(webhook, JSON.stringify({ content: `âœ… **SUCCESS**: ${to} said YES!` }));
                };

                const rejections = ["No", "Are you sure?", "Really?", "Don't do this", "Last chance!", "Heartbreaker!"];

                return (
                    <div className="min-h-screen flex items-center justify-center p-4" 
                         style={{ transform: `perspective(1000px) rotateX(${tilt.y}deg) rotateY(${tilt.x}deg)` }}>
                        <div className="glass-panel p-8 sm:p-12 rounded-[40px] flex flex-col items-center max-w-md w-full relative transition-transform duration-100 ease-out">
                            <div className="mb-8 relative w-40 h-40 animate-float">
                                <svg viewBox="0 0 24 24" className="w-full h-full drop-shadow-[0_10px_20px_rgba(255,100,100,0.5)]">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="#ff4d6d" stroke="white" strokeWidth="1"/>
                                </svg>
                            </div>
                            
                            <h1 className="font-serif text-3xl sm:text-4xl text-slate-800 font-bold text-center mb-10 leading-tight">
                                {msg}
                            </h1>

                            <div className="flex flex-col items-center gap-4 w-full relative h-32">
                                <button onClick={handleYes} style={{ transform: `scale(${yesScale})` }} className="z-20 bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold text-xl py-4 px-12 rounded-full shadow-xl hover:shadow-2xl hover:scale-105 transition-all w-full max-w-[240px]">
                                    Yes, I will! ðŸ’–
                                </button>
                                
                                <button onMouseEnter={moveNo} onTouchStart={(e) => {e.preventDefault(); moveNo()}} 
                                    style={{ transform: `translate(${noBtn.x}px, ${noBtn.y}px)` }}
                                    className="glass-button text-slate-600 font-medium py-2 px-6 rounded-full absolute bottom-0 border border-white/40 hover:bg-white/30 transition-all duration-300">
                                    {rejections[Math.min(noBtn.hover, 5)]}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Step 3 & 4: Success & Scheduler
            const [plan, setPlan] = useState({ date: '', time: '', food: 'Sushi', activity: 'Dinner' });

            const finish = () => {
                const text = `Hey ${from}! I said YES! ðŸ’–\n\nI'm free on ${plan.date} at ${plan.time}.\nWe're getting ${plan.food} for ${plan.activity}.\n\nAdd to calendar: (See attachment)`;
                generateICS({ ...plan, who: from });
                window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-panel p-8 rounded-[32px] w-full max-w-md animate-pop">
                        <div className="text-center mb-8">
                            <h1 className="font-serif text-3xl text-white font-bold mb-2">It's a Date! ðŸŽ‰</h1>
                            <p className="text-white/80">Lock it in so I don't forget.</p>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="text-xs text-white/70 ml-2 mb-1 block">When are you free?</label>
                                <input type="date" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, date: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-xs text-white/70 ml-2 mb-1 block">What time?</label>
                                <input type="time" className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, time: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <select className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, food: e.target.value})}>
                                    <option className="text-black">Sushi</option>
                                    <option className="text-black">Italian</option>
                                    <option className="text-black">Tacos</option>
                                    <option className="text-black">Steak</option>
                                </select>
                                <select className="w-full glass-input rounded-xl px-4 py-3" onChange={e => setPlan({...plan, activity: e.target.value})}>
                                    <option className="text-black">Dinner</option>
                                    <option className="text-black">Drinks</option>
                                    <option className="text-black">Movie</option>
                                    <option className="text-black">Walk</option>
                                </select>
                            </div>
                        </div>

                        <button onClick={finish} className="w-full bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-600 transition-all mt-8 flex items-center justify-center gap-2">
                            <Calendar size={20}/> Confirm & Send
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [params, setParams] = useState(null);
            useEffect(() => {
                const p = new URLSearchParams(window.location.search);
                if (p.has('to')) setParams(p);
            }, []);
            return params ? <TargetMode params={params} /> : <CreatorMode />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
